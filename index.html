<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <!-- iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Pattern tester">

    <!-- Иконка для iOS -->
<!--    <link rel="apple-touch-icon" href="/icons/icon-180.png">-->

    <title>Pattern tester</title>
    <style>
        .wrapper {
            display: flex;
            flex-direction: column;
            gap: 16px;
            align-items: flex-start;
        }
        .preview_wrapper {
            width: -webkit-fill-available;
        }
        .preview {
            border: 2px dashed #ccc;
            height: 600px;
            width: 600px;
            background-repeat: repeat;
            background-position: top left;
            background-size: auto;
            transform-origin: top left;
        }
        .brake {
            border: none;
            height: 1px;
            background-color: #cbcbcb;
            width: 600px;
        }
        .scale-wrapper {
            transform-origin: top left;
            transform: scale(1);
        }

        .rotate-box {
            transform-origin: center;
            transform: rotate(0deg);
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <div>
            <input type="file" id="imageInput" accept="image/*" />
        </div>
        <div class="wrapper">
            <div>
                <span>Repeat mode</span>
                <select id="repeatMode">
                    <option value="repeat">repeat</option>
                    <option value="no-repeat">no-repeat</option>
                    <option value="repeat-x">repeat-x</option>
                    <option value="repeat-y">repeat-y</option>
                </select>
            </div>
            <hr class="brake">
            <div>
                <span>Dimensions (px)</span>
                <input id="dimensions" type="number" value="600"/>
            </div>
            <hr class="brake">
            <div class="wrapper" style="width: 600px;">
                <div>Rotate: <span id="rotateValue">0</span></div>
                <input type="range" id="rotateRange" min="0" max="270" step="90" value="0">
            </div>
            <hr class="brake">
            <div class="wrapper" style="width: 600px;">
                <div>Scale: <span id="scaleValue">1</span></div>
                <input type="range" id="scaleRange" min="0.1" max="3" step="0.1" value="1" disabled>
                <div>
                    <input id="fit" type="checkbox" checked/>
                    <span>Set scale to fit page</span>
                </div>
            </div>
            <hr class="brake">
        </div>
        <div class="wrapper preview_wrapper">
            <span>Repeated pattern</span>
            <div id="scale" class="scale-wrapper">
                <div id="rotate" class="rotate-box">
                    <div id="preview" class="preview"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const imageInput = document.getElementById('imageInput');
        const preview = document.getElementById('preview');
        const repeatSelect = document.getElementById('repeatMode');
        const dimensions = document.getElementById('dimensions');
        const rotateRange = document.getElementById('rotateRange');
        const rotateValue = document.getElementById('rotateValue');
        const scaleRange = document.getElementById('scaleRange');
        const scaleValue = document.getElementById('scaleValue');
        const scaleWrapper = document.getElementById('scale');
        const rotateWrapper = document.getElementById('rotate');
        const fit = document.getElementById('fit');

        let fitPreview = true;

        dimensions.addEventListener('change', () => {
            const size = dimensions.value;
            preview.style.width = size + 'px';
            preview.style.height = size + 'px';
            scalePreview();
        });

        fit.addEventListener('change', () => {
            fitPreview = fit.checked;
            scaleRange.disabled = fitPreview;
            scalePreview();
        });

        repeatSelect.addEventListener('change', () => {
            preview.style.backgroundRepeat = repeatSelect.value;
        });

        rotateRange.addEventListener('input', () => {
            rotateValue.textContent = rotateRange.value;
            rotateWrapper.style.rotate = rotateRange.value + 'deg';
        });

        scaleRange.addEventListener('input', () => {
            if (!fitPreview) {
                scaleValue.textContent = scaleRange.value;
                scaleWrapper.style.scale = scaleRange.value;
            }
        });

        imageInput.addEventListener('change', () => {
            const file = imageInput.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = () => {
                preview.style.backgroundImage = `url(${reader.result})`;
            };
            reader.readAsDataURL(file);
        });

        function scalePreview() {
            if (fitPreview) {
                const viewport = window.visualViewport;
                const size = dimensions.value;
                const scale = String(Math.min((viewport.width - 20) / size, 1));

                scaleWrapper.style.scale = scale;
                if (scale !== '1') {
                    scaleValue.textContent = parseFloat(scale).toFixed(2);
                    scaleRange.value = parseFloat(scale).toFixed(2);
                } else {
                    scaleValue.textContent = scale;
                    scaleRange.value = scale;
                }
            } else {
                scaleWrapper.style.scale = '1';
                scaleValue.textContent = '1';
                scaleRange.value = '1';
            }
        }
    </script>
</body>
